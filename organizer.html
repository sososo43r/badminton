<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å‰²ã‚Šå½“ã¦ã€ç®¡ç†è€…ç”¨ã€‘</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f8ff; }
        .container { max-width: 1000px; margin: 20px auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2 { color: #0056b3; border-bottom: 2px solid #0056b3; }
        button { color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
        button:disabled { background-color: #ccc; }
        #generate-btn { background-color: #007bff; }
        #add-player-btn { background-color: #28a745; }
        #game-controls { display: none; margin: 10px 0; text-align: center; }
        #prev-game-btn, #next-game-btn { background-color: #6c757d; margin: 0 5px; }
        .court-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; padding: 20px; background-color: #fafafa; min-height: 150px; }
        .court { background-color: #e67e22; border: 2px solid #fff; width: 150px; height: 300px; position: relative; color: white; font-weight: bold; }
        .court-title { text-align: center; background-color: rgba(0,0,0,0.3); }
        .player { position: absolute; width: 100%; text-align: center; }
        .player-top { top: 20px; }
        .player-bottom { bottom: 20px; }
        .vs { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .net { position: absolute; top: 50%; left: 5%; right: 5%; border-top: 2px dashed #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ccc; padding: 12px; text-align: center; }
        th { background-color: #007bff; color: white; }
        td.rest-player { background-color: #e9ecef; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¸ ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³ ã‚·ãƒ³ã‚°ãƒ«ã‚¹å‰²ã‚Šå½“ã¦ã€ç®¡ç†è€…ç”¨ã€‘</h1>
        <div class="setup-section">
            <h2>â‘  è¨­å®š</h2>
            <div><label>ã‚³ãƒ¼ãƒˆã®é¢æ•°ï¼š<input type="number" id="court-count" value="3" min="1"></label></div>
            <div>
                <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</p>
                <div id="name-inputs"></div>
                <button id="add-player-btn">ï¼‹ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ </button>
            </div>
            <button id="generate-btn">ã‚³ãƒ¼ãƒˆå‰²ã‚Šå½“ã¦ã‚’ä½œæˆãƒ»å…±æœ‰</button>
        </div>
        <div class="result-section">
            <h2>â‘¡ ã‚³ãƒ¼ãƒˆå‰²ã‚Šå½“ã¦ï¼ˆ<span id="game-number"></span> ã‚²ãƒ¼ãƒ ç›®ï¼‰</h2>
            <div id="game-controls">
                <button id="prev-game-btn">ï¼œ å‰ã®ã‚²ãƒ¼ãƒ </button>
                <button id="next-game-btn">æ¬¡ã®ã‚²ãƒ¼ãƒ  ï¼</button>
            </div>
            <div id="court-container"><p>ä½œæˆãƒœã‚¿ãƒ³ã§è¡¨ç¤ºã—ã¾ã™</p></div>
            <h2>â‘¢ å¯¾æˆ¦çµ„ã¿åˆã‚ã›è¡¨ï¼ˆç·å½“ãŸã‚Šï¼‰</h2>
            <div id="schedule-container"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // â–¼â–¼â–¼â–¼â–¼ ã‚¹ãƒ†ãƒƒãƒ—1ã§å–å¾—ã—ãŸè‡ªåˆ†ã®firebaseConfigã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ â–¼â–¼â–¼â–¼â–¼
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBwaFZUZOTn7UOovrQnX2yQWB6Kgb1cejI",
  authDomain: "badminton-app-98840.firebaseapp.com",
  databaseURL: "https://badminton-app-98840-default-rtdb.firebaseio.com",
  projectId: "badminton-app-98840",
  storageBucket: "badminton-app-98840.firebasestorage.app",
  messagingSenderId: "237816615264",
  appId: "1:237816615264:web:68cdafa5cc46e9edcb4e05"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        // Firebaseã®åˆæœŸåŒ–
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ã“ã‚Œã‚ˆã‚Šä¸‹ã®JavaScriptã¯å‰å›ã®ã‚‚ã®ã¨ã»ã¼åŒã˜ã§ã™ãŒã€
        // ãƒ‡ãƒ¼ã‚¿ã‚’Firebaseã«æ›¸ãè¾¼ã‚€å‡¦ç†ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

        const generateBtn = document.getElementById('generate-btn');
        const addPlayerBtn = document.getElementById('add-player-btn');
        const nameInputsContainer = document.getElementById('name-inputs');
        const courtCountInput = document.getElementById('court-count');
        const courtContainer = document.getElementById('court-container');
        const scheduleContainer = document.getElementById('schedule-container');
        const gameControls = document.getElementById('game-controls');
        const prevGameBtn = document.getElementById('prev-game-btn');
        const nextGameBtn = document.getElementById('next-game-btn');
        const gameNumberSpan = document.getElementById('game-number');

        let fullSchedule = [];
        let currentGameIndex = 0;

        document.addEventListener('DOMContentLoaded', () => {
            for (let i = 0; i < 4; i++) createPlayerInput();
        });

        addPlayerBtn.addEventListener('click', createPlayerInput);

        generateBtn.addEventListener('click', () => {
            const players = getPlayersFromInputs();
            if (players.length < 2) {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’2åä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            const courtCount = parseInt(courtCountInput.value, 10);
            fullSchedule = generateRoundRobin(players);
            currentGameIndex = 0;
            
            // Firebaseã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€
            database.ref('badminton').set({
                schedule: fullSchedule,
                gameIndex: currentGameIndex,
                courtCount: courtCount,
                players: players
            }).then(() => {
                alert('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒä½œæˆãƒ»å…±æœ‰ã•ã‚Œã¾ã—ãŸï¼');
            });

            updateGameView();
            displayScheduleTable(fullSchedule, players);
            gameControls.style.display = 'block';
        });

        prevGameBtn.addEventListener('click', () => {
            if (currentGameIndex > 0) {
                currentGameIndex--;
                // Firebaseã®ã‚²ãƒ¼ãƒ ç•ªå·ã‚’æ›´æ–°
                database.ref('badminton/gameIndex').set(currentGameIndex);
                updateGameView();
            }
        });

        nextGameBtn.addEventListener('click', () => {
            if (currentGameIndex < fullSchedule.length - 1) {
                currentGameIndex++;
                // Firebaseã®ã‚²ãƒ¼ãƒ ç•ªå·ã‚’æ›´æ–°
                database.ref('badminton/gameIndex').set(currentGameIndex);
                updateGameView();
            }
        });

        function createPlayerInput() {
            const input = document.createElement('input');
            input.placeholder = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ${nameInputsContainer.children.length + 1}`;
            nameInputsContainer.appendChild(input);
        }

        function getPlayersFromInputs() {
            const inputs = nameInputsContainer.getElementsByTagName('input');
            return Array.from(inputs).map(input => input.value.trim()).filter(name => name);
        }

        function generateRoundRobin(players) {
            let localPlayers = [...players];
            if (localPlayers.length % 2 !== 0) {
                const lastPlayer = localPlayers.pop();
                localPlayers.unshift(lastPlayer);
                localPlayers.push('ä¼‘æ†©');
            }
            const playerCount = localPlayers.length;
            const rounds = [];
            for (let r = 0; r < playerCount - 1; r++) {
                const roundMatches = [];
                for (let i = 0; i < playerCount / 2; i++) {
                    const p1 = localPlayers[i];
                    const p2 = localPlayers[playerCount - 1 - i];
                    if (p1 !== 'ä¼‘æ†©' && p2 !== 'ä¼‘æ†©') roundMatches.push([p1, p2]);
                }
                rounds.push(roundMatches);
                localPlayers.splice(1, 0, localPlayers.pop());
            }
            return rounds;
        }

        function updateGameView() {
            const courtCount = parseInt(courtCountInput.value, 10);
            const currentMatches = fullSchedule[currentGameIndex] || [];
            gameNumberSpan.textContent = currentGameIndex + 1;
            courtContainer.innerHTML = '';
            for (let i = 0; i < courtCount; i++) {
                const courtDiv = document.createElement('div');
                courtDiv.className = 'court';
                let courtHTML = `<div class="court-title">ç¬¬${i + 1}ã‚³ãƒ¼ãƒˆ</div><div class="net"></div>`;
                if (i < currentMatches.length) {
                    courtHTML += `<div class="player player-top">${currentMatches[i][0]}</div><div class="vs">vs</div><div class="player player-bottom">${currentMatches[i][1]}</div>`;
                } else {
                    courtHTML += `<div class="vs">ç©ºã</div>`;
                }
                courtDiv.innerHTML = courtHTML;
                courtContainer.appendChild(courtDiv);
            }
            prevGameBtn.disabled = (currentGameIndex === 0);
            nextGameBtn.disabled = (currentGameIndex === fullSchedule.length - 1);
        }
        
        function displayScheduleTable(schedule, originalPlayers) {
            scheduleContainer.innerHTML = '';
            const table = document.createElement('table');
            const courtCount = parseInt(courtCountInput.value, 10);
            let tableHTML = `<thead><tr><th>ã‚²ãƒ¼ãƒ </th>`;
            for(let i=1; i<=courtCount; i++) tableHTML += `<th>ç¬¬${i}ã‚³ãƒ¼ãƒˆ</th>`;
            tableHTML += `<th>ä¼‘æ†©ã®äºº</th></tr></thead><tbody>`;
            let allP = [...originalPlayers];
            if(allP.length % 2 !== 0) allP.push("ä¼‘æ†©");
            schedule.forEach((round, roundIndex) => {
                const playingNow = new Set(round.flat());
                const restingPlayer = allP.find(p => !playingNow.has(p)) || 'ãªã—';
                tableHTML += `<tr><td>ç¬¬${roundIndex + 1}ã‚²ãƒ¼ãƒ </td>`;
                for (let i = 0; i < courtCount; i++) {
                    tableHTML += `<td>${round[i] ? `${round[i][0]} vs ${round[i][1]}` : '-'}</td>`;
                }
                tableHTML += `<td class="rest-player">${restingPlayer}</td></tr>`;
            });
            table.innerHTML = tableHTML + '</tbody>';
            scheduleContainer.appendChild(table);
        }
    </script>
</body>
</html>