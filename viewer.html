<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>バドミントンコート割り当て</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f8ff; text-align: center; }
        .container { max-width: 1000px; margin: 10px auto; padding: 10px; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2 { color: #0056b3; border-bottom: 2px solid #0056b3; }
        #status { font-size: 1.2em; color: #d9534f; font-weight: bold; min-height: 2em; padding-top: 1em;}
        .court-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; padding: 20px; background-color: #fafafa; min-height: 320px; }
        .court { background-color: #e67e22; border: 2px solid #fff; width: 150px; height: 300px; position: relative; color: white; font-weight: bold; }
        .court-title { text-align: center; background-color: rgba(0,0,0,0.3); }
        .player { position: absolute; width: 100%; text-align: center; font-size: 1.2em; }
        .player-top { top: 20px; }
        .player-bottom { bottom: 20px; }
        .vs { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .net { position: absolute; top: 50%; left: 5%; right: 5%; border-top: 2px dashed #fff; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ccc; padding: 12px; text-align: center; }
        th { background-color: #007bff; color: white; }
        tr.current-game td { background-color: #fffbe6 !important; font-weight: bold; }
        td.rest-player { background-color: #e9ecef; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏸 現在のコート割り当て</h1>
        <div id="status">管理者が試合を作成するのを待っています...</div>
        <div id="court-container"></div>
        <h2>対戦組み合わせ表</h2>
        <div id="schedule-container"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // ▼▼▼▼▼ ステップ1で取得した自分のfirebaseConfigをここに貼り付け ▼▼▼▼▼
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBwaFZUZOTn7UOovrQnX2yQWB6Kgb1cejI",
  authDomain: "badminton-app-98840.firebaseapp.com",
  databaseURL: "https://badminton-app-98840-default-rtdb.firebaseio.com",
  projectId: "badminton-app-98840",
  storageBucket: "badminton-app-98840.firebasestorage.app",
  messagingSenderId: "237816615264",
  appId: "1:237816615264:web:68cdafa5cc46e9edcb4e05"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
        // ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

        // Firebaseの初期化
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const statusDiv = document.getElementById('status');
        const courtContainer = document.getElementById('court-container');
        const scheduleContainer = document.getElementById('schedule-container');

        // Firebaseのデータ変更を監視
        database.ref('badminton').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && data.schedule) {
                statusDiv.textContent = `ただいま ${data.gameIndex + 1} ゲーム目です！`;
                updateGameView(data);
                displayScheduleTable(data);
            } else {
                statusDiv.textContent = '管理者が試合を作成するのを待っています...';
                courtContainer.innerHTML = '';
                scheduleContainer.innerHTML = '';
            }
        });

        function updateGameView(data) {
            const courtCount = data.courtCount;
            const currentMatches = data.schedule[data.gameIndex] || [];
            courtContainer.innerHTML = '';
            for (let i = 0; i < courtCount; i++) {
                const courtDiv = document.createElement('div');
                courtDiv.className = 'court';
                let courtHTML = `<div class="court-title">第${i + 1}コート</div><div class="net"></div>`;
                if (i < currentMatches.length) {
                    courtHTML += `<div class="player player-top">${currentMatches[i][0]}</div><div class="vs">vs</div><div class="player player-bottom">${currentMatches[i][1]}</div>`;
                } else {
                    courtHTML += `<div class="vs">空き</div>`;
                }
                courtDiv.innerHTML = courtHTML;
                courtContainer.appendChild(courtDiv);
            }
        }
        
        function displayScheduleTable(data) {
            scheduleContainer.innerHTML = '';
            const table = document.createElement('table');
            const courtCount = data.courtCount;
            let tableHTML = `<thead><tr><th>ゲーム</th>`;
            for(let i=1; i<=courtCount; i++) tableHTML += `<th>第${i}コート</th>`;
            tableHTML += `<th>休憩の人</th></tr></thead><tbody>`;
            let allP = [...data.players];
            if(allP.length % 2 !== 0) allP.push("休憩");
            data.schedule.forEach((round, roundIndex) => {
                const playingNow = new Set(round.flat());
                const restingPlayer = allP.find(p => !playingNow.has(p)) || 'なし';
                // 現在のゲームの行をハイライトするためのクラスを追加
                const isCurrentGame = roundIndex === data.gameIndex ? 'class="current-game"' : '';
                tableHTML += `<tr ${isCurrentGame}><td>第${roundIndex + 1}ゲーム</td>`;
                for (let i = 0; i < courtCount; i++) {
                    tableHTML += `<td>${round[i] ? `${round[i][0]} vs ${round[i][1]}` : '-'}</td>`;
                }
                tableHTML += `<td class="rest-player">${restingPlayer}</td></tr>`;
            });
            table.innerHTML = tableHTML + '</tbody>';
            scheduleContainer.appendChild(table);
        }
    </script>
</body>
</html>